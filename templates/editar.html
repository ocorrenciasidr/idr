<!-- templates/editar.html -->
<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="utf-8"/>
  <title>SGCE — Editar Ocorrência</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    :root{--bg:#0f1724;--panel:#071428;--muted:#b6c2d1;}
    body{background:var(--bg);color:#fff;font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto;padding:20px;}
    .panel{max-width:980px;margin:auto;background:linear-gradient(180deg,#0b1220,#07101a);padding:22px;border-radius:12px;box-shadow:0 10px 30px rgba(0,0,0,.6)}
    label{font-weight:600;color:#e6eef8}
    .form-control,.form-select,textarea{background:#071428;color:#e6eef8;border:1px solid rgba(255,255,255,0.06)}
    .readonly{background:#0b1220;color:#cbd5e1}
    .btn-dark{background:#1f2937;color:#fff;border-radius:8px;border:1px solid rgba(255,255,255,0.04);font-weight:600}
    .btn-outline-light{color:#fff;border-color:rgba(255,255,255,0.06);border-radius:8px}
    .muted{color:var(--muted);font-size:.92rem}
    textarea.editavel{background:#fff;color:#111}
    textarea.readonly{background:#0b1220;color:#cbd5e1}
  </style>
</head>
<body>
  <div class="panel">
    {% set occ = (ocorrencia if (ocorrencia is defined) else (ocorrencias if (ocorrencias is defined) else None)) %}
    <h3 class="mb-2">Ocorrência - {{ occ.ID if occ else '' }}</h3>
    <div class="mb-3 muted">Modo: <strong>{{ modo if modo is defined else 'VISUALIZAÇÃO' }}</strong></div>

    {% set modo_local = modo if (modo is defined) else '' %}
    {% set tipo = tipo_acao if (tipo_acao is defined) else '' %}
    {% if modo_local == 'ATENDIMENTO_INDIVIDUAL' and tipo %}
      {% set action_url = url_for('atendimento', oid=occ.ID, tipo_acao=tipo) %}
    {% elif modo_local == 'EDITAR' %}
      {% set action_url = url_for('editar_completo', oid=occ.ID) %}
    {% else %}
      {% set action_url = url_for('editar', oid=occ.ID) %}
    {% endif %}

    <form method="post" action="{{ action_url }}">
      <div class="row g-3">
        <div class="col-md-3">
          <label>ID</label>
          <input class="form-control readonly" value="{{ occ.ID }}" readonly>
        </div>

        <div class="col-md-3">
          <label>Data (DCO)</label>
          <input class="form-control readonly" value="{{ occ.DCO or '' }}" readonly>
        </div>

        <div class="col-md-3">
          <label>Hora (HCO)</label>
          <input class="form-control readonly" value="{{ occ.HCO or '' }}" readonly>
        </div>

        <div class="col-md-3">
          <label>Status</label>
          {% if modo_local == 'EDITAR' %}
            <select name="STATUS" class="form-select">
              <option value="ATENDIMENTO" {% if occ.STATUS=='ATENDIMENTO' %}selected{% endif %}>ATENDIMENTO</option>
              <option value="FINALIZADA" {% if occ.STATUS=='FINALIZADA' %}selected{% endif %}>FINALIZADA</option>
              <option value="ASSINADA" {% if occ.STATUS=='ASSINADA' %}selected{% endif %}>ASSINADA</option>
            </select>
          {% else %}
            <input class="form-control readonly" value="{{ occ.STATUS or '' }}" readonly>
          {% endif %}
        </div>

        <div class="col-md-6">
          <label>Aluno</label>
          {% if modo_local == 'EDITAR' %}
            <input name="ALUNO" class="form-control" value="{{ occ.ALUNO or '' }}">
          {% else %}
            <input class="form-control readonly" value="{{ occ.ALUNO or '' }}" readonly>
          {% endif %}
        </div>

        <div class="col-md-3">
          <label>Sala</label>
          {% if modo_local == 'EDITAR' %}
            <select name="SALA" class="form-select">
              {% for s in salas_disp %}<option value="{{ s }}" {% if occ.SALA==s %}selected{% endif %}>{{ s }}</option>{% endfor %}
            </select>
          {% else %}
            <input class="form-control readonly" value="{{ occ.SALA or '' }}" readonly>
          {% endif %}
        </div>

        <div class="col-md-3">
          <label>Professor</label>
          {% if modo_local == 'EDITAR' %}
            <select name="PROFESSOR" class="form-select">
              {% for p in professores_disp %}<option value="{{ p }}" {% if occ.PROFESSOR==p %}selected{% endif %}>{{ p }}</option>{% endfor %}
            </select>
          {% else %}
            <input class="form-control readonly" value="{{ occ.PROFESSOR or '' }}" readonly>
          {% endif %}
        </div>

        <div class="col-12">
          <label>Descrição</label>
          {% if modo_local == 'EDITAR' %}
            <textarea name="DESCRICAO" class="form-control" rows="4">{{ occ.DESCRICAO or '' }}</textarea>
          {% else %}
            <textarea class="form-control readonly" rows="4" readonly>{{ occ.DESCRICAO or '' }}</textarea>
          {% endif %}
        </div>

        <!-- ATP (Professor) -->
        <div class="col-12">
          <label>Atendimento Professor (ATP)</label>
          {% if modo_local == 'EDITAR' %}
            <textarea name="ATP" class="form-control" rows="3">{{ occ.ATP or '' }}</textarea>
          {% else %}
            <textarea class="form-control readonly" rows="3" readonly>{{ occ.ATP or '' }}</textarea>
          {% endif %}
        </div>

        <!-- ATT / ATC / ATG -->
        <div class="col-md-4">
          <label>Atendimento Tutor (ATT)</label>
          {% if modo_local == 'ATENDIMENTO_INDIVIDUAL' and campo_atendimento == 'ATT' %}
            <textarea name="ATT" class="form-control editavel" rows="3">{{ occ.ATT or '' }}</textarea>
          {% elif modo_local == 'EDITAR' %}
            <textarea name="ATT" class="form-control" rows="3">{{ occ.ATT or '' }}</textarea>
          {% else %}
            <textarea class="form-control readonly" rows="3" readonly>{{ occ.ATT or '' }}</textarea>
          {% endif %}
        </div>

        <div class="col-md-4">
          <label>Atendimento Coordenação (ATC)</label>
          {% if modo_local == 'ATENDIMENTO_INDIVIDUAL' and campo_atendimento == 'ATC' %}
            <textarea name="ATC" class="form-control editavel" rows="3">{{ occ.ATC or '' }}</textarea>
          {% elif modo_local == 'EDITAR' %}
            <textarea name="ATC" class="form-control" rows="3">{{ occ.ATC or '' }}</textarea>
          {% else %}
            <textarea class="form-control readonly" rows="3" readonly>{{ occ.ATC or '' }}</textarea>
          {% endif %}
        </div>

        <div class="col-md-4">
          <label>Atendimento Gestão (ATG)</label>
          {% if modo_local == 'ATENDIMENTO_INDIVIDUAL' and campo_atendimento == 'ATG' %}
            <textarea name="ATG" class="form-control editavel" rows="3">{{ occ.ATG or '' }}</textarea>
          {% elif modo_local == 'EDITAR' %}
            <textarea name="ATG" class="form-control" rows="3">{{ occ.ATG or '' }}</textarea>
          {% else %}
            <textarea class="form-control readonly" rows="3" readonly>{{ occ.ATG or '' }}</textarea>
          {% endif %}
        </div>

        <!-- PT/PC/PG -->
        <div class="col-md-4">
          <label>PT</label>
          {% if modo_local == 'EDITAR' %}
            <select name="PT" class="form-select">
              <option value="SIM" {% if occ.PT=='SIM' %}selected{% endif %}>SIM</option>
              <option value="NÃO" {% if occ.PT=='NÃO' %}selected{% endif %}>NÃO</option>
            </select>
          {% else %}
            <input class="form-control readonly" value="{{ occ.PT or '' }}" readonly>
          {% endif %}
        </div>

        <div class="col-md-4">
          <label>PC</label>
          {% if modo_local == 'EDITAR' %}
            <select name="PC" class="form-select">
              <option value="SIM" {% if occ.PC=='SIM' %}selected{% endif %}>SIM</option>
              <option value="NÃO" {% if occ.PC=='NÃO' %}selected{% endif %}>NÃO</option>
            </select>
          {% else %}
            <input class="form-control readonly" value="{{ occ.PC or '' }}" readonly>
          {% endif %}
        </div>

        <div class="col-md-4">
          <label>PG</label>
          {% if modo_local == 'EDITAR' %}
            <select name="PG" class="form-select">
              <option value="SIM" {% if occ.PG=='SIM' %}selected{% endif %}>SIM</option>
              <option value="NÃO" {% if occ.PG=='NÃO' %}selected{% endif %}>NÃO</option>
            </select>
          {% else %}
            <input class="form-control readonly" value="{{ occ.PG or '' }}" readonly>
          {% endif %}
        </div>

        <!-- DT / DC / DG -->
        <div class="col-md-4"><label>DT</label><input class="form-control readonly" value="{{ occ.DT or '' }}" readonly></div>
        <div class="col-md-4"><label>DC</label><input class="form-control readonly" value="{{ occ.DC or '' }}" readonly></div>
        <div class="col-md-4"><label>DG</label><input class="form-control readonly" value="{{ occ.DG or '' }}" readonly></div>

        <div class="col-12 d-flex gap-2 justify-content-end mt-3">
          <a href="{{ url_for('index') }}" class="btn btn-outline-light">Voltar</a>
          {% if modo_local == 'ATENDIMENTO_INDIVIDUAL' and tipo %}
            <button type="submit" class="btn btn-dark">Salvar Atendimento</button>
          {% elif modo_local == 'EDITAR' %}
            <button type="submit" class="btn btn-dark">Salvar Alterações</button>
          {% endif %}
        </div>
      </div>
    </form>
  </div>
</body>
</html>
