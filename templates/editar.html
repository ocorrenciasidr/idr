<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Editar Ocorrência</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
</head>
<body class="p-4">

<h1 class="mb-4">Editar Ocorrência Nº: {{ ocorrencia.ID }}</h1>
<h3 class="mb-4 text-secondary">Aluno: {{ ocorrencia.ALUNO }} ({{ ocorrencia.SALA }}) | Status: {{ ocorrencia.STATUS }}</h3>

{% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
        {% for category, message in messages %}
        <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
        {% endfor %}
    {% endif %}
{% endwith %}

<form method="POST" action="{{ url_for('editar', oid=ocorrencia.ID, papel=papel) }}"> 

    <div class="row">
        <div class="col-md-4 mb-3">
            <label class="form-label">Professor:</label>
            <input type="text" class="form-control" value="{{ ocorrencia.PROFESSOR | default('N/D') }}" readonly>
        </div>
        <div class="col-md-4 mb-3">
            <label class="form-label">Tutor:</label>
            <input type="text" class="form-control" value="{{ ocorrencia.TUTOR | default('N/D') }}" readonly>
        </div>
        <div class="col-md-4 mb-3">
            <label class="form-label">Data de Criação (DCO):</label>
            <input type="text" class="form-control" value="{{ ocorrencia.DCO | default('N/D') }}" readonly>
        </div>
    </div>
    
    <div class="mb-3">
        <label class="form-label">Descrição da Ocorrência:</label>
        <textarea class="form-control" name="DESCRICAO" rows="4" 
            {% if not permissoes.editar_descricao %}readonly{% endif %} required>
            {{ ocorrencia.DESCRICAO | default('') }}
        </textarea>
    </div>

    <hr>
    <h2>Registro de Atendimentos</h2>

    <div class="mb-3">
        <label class="form-label">Atendimento Professor (ATP):</label>
        <textarea class="form-control" name="ATP" rows="2" 
            {% if not permissoes.editar_atp %}readonly{% endif %}>
            {{ ocorrencia.AT_PROFESSOR | default('') }}
        </textarea>
    </div>

    <div class="mb-3">
        <label class="form-label">Atendimento Tutor (ATT) - FT: {{ ocorrencia.FT | default('N/D') }} | DT: {{ ocorrencia.DT | default('N/D') }}:</label>
        <textarea class="form-control" name="ATT" rows="2" 
            {% if not permissoes.editar_att %}readonly{% endif %}>
            {{ ocorrencia.ATT | default('') }}
        </textarea>
    </div>

    <div class="mb-3">
        <label class="form-label">Atendimento Coordenação (ATC) - FC: {{ ocorrencia.FC | default('N/D') }} | DC: {{ ocorrencia.DC | default('N/D') }}:</label>
        <textarea class="form-control" name="ATC" rows="2" 
            {% if not permissoes.editar_atc %}readonly{% endif %}>
            {{ ocorrencia.ATC | default('') }}
        </textarea>
    </div>

    <div class="mb-3">
        <label class="form-label">Atendimento Gestão (ATG) - FG: {{ ocorrencia.FG | default('N/D') }} | DG: {{ ocorrencia.DG | default('N/D') }}:</label>
        <textarea class="form-control" name="ATG" rows="2" 
            {% if not permissoes.editar_atg %}readonly{% endif %}>
            {{ ocorrencia.ATG | default('') }}
        </textarea>
    </div>
    
    {% if permissoes.editar_descricao or permissoes.editar_atp or permissoes.editar_att or permissoes.editar_atc or permissoes.editar_atg %}
        <button type="submit" class="btn btn-primary">Salvar Alterações</button>
    {% else %}
        <div class="alert alert-info" role="alert">Modo de visualização. Não é possível salvar alterações.</div>
    {% endif %}
    
    <a href="{{ url_for('index') }}" class="btn btn-secondary">Voltar</a>
</form>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>