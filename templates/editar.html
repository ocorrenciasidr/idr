<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Editar Ocorrência</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
</head>
<body class="p-4" data-bs-theme="dark">

<h1 class="mb-4">Editar Ocorrência Nº: {{ ocorrencia.ID }}</h1>
<h3 class="mb-4 text-secondary">Aluno: {{ ocorrencia.ALUNO }} ({{ ocorrencia.SALA }}) | Status: {{ ocorrencia.STATUS }}</h3>

{% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
        {% for category, message in messages %}
        <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
        {% endfor %}
    {% endif %}
{% endwith %}

<form method="POST" action="{{ url_for('editar', oid=ocorrencia.ID, papel='editar') }}">

    <!-- Descrição -->
    <div class="mb-3">
        <label class="form-label">Descrição da Ocorrência:</label>
        <textarea class="form-control" name="DESCRICAO" rows="3"
            {% if not permissoes.editar_descricao %}readonly{% endif %}>{{ ocorrencia.DESCRICAO | default('') }}</textarea>
    </div>

    <!-- Atendimento Professor -->
    <div class="mb-3">
        <label class="form-label">Atendimento Professor (ATP):</label>
        <textarea class="form-control" name="ATP" rows="2"
            {% if not permissoes.editar_atp %}readonly{% endif %}>{{ ocorrencia.ATP | default('') }}</textarea>
    </div>

    <!-- Atendimento Tutor -->
    <div class="mb-3">
        <label class="form-label">ATT - FT: {{ ocorrencia.FT }} | DT: {{ ocorrencia.DT }}:</label>
        <textarea class="form-control" name="ATT" rows="2"
            {% if not permissoes.editar_att %}readonly{% endif %}>{{ ocorrencia.ATT | default('') }}</textarea>
    </div>

    <!-- Atendimento Coordenação -->
    <div class="mb-3">
        <label class="form-label">ATC - FC: {{ ocorrencia.FC }} | DC: {{ ocorrencia.DC }}:</label>
        <textarea class="form-control" name="ATC" rows="2"
            {% if not permissoes.editar_atc %}readonly{% endif %}>{{ ocorrencia.ATC | default('') }}</textarea>
    </div>

    <!-- Atendimento Gestão -->
    <div class="mb-3">
        <label class="form-label">ATG - FG: {{ ocorrencia.FG }} | DG: {{ ocorrencia.DG }}:</label>
        <textarea class="form-control" name="ATG" rows="2"
            {% if not permissoes.editar_atg %}readonly{% endif %}>{{ ocorrencia.ATG | default('') }}</textarea>
    </div>

    {% if permissoes.editar_descricao or permissoes.editar_atp or permissoes.editar_att or permissoes.editar_atc or permissoes.editar_atg %}
        <button type="submit" class="btn btn-primary">Salvar Alterações</button>
    {% else %}
        <div class="alert alert-info">Modo Visualização. Nenhuma alteração permitida.</div>
    {% endif %}
</form>

<a href="{{ url_for('index') }}" class="btn btn-secondary mt-3">Voltar para a Lista</a>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>

