<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>SGCE - IMPRESS√ÉO DE OCORR√äNCIAS</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
</head>
<body class="p-4" data-bs-theme="dark"> <div class="container mt-4">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <a href="{{ url_for('relatorio_inicial') }}" class="btn btn-secondary">‚¨ÖÔ∏è Voltar aos Relat√≥rios</a>
    <h2 class="text-center flex-grow-1 m-0">SISTEMA DE GEST√ÉO DE CONVIV√äNCIA ESCOLAR <br> IMPRESS√ÉO DE OCORR√äNCIAS</h2>
  </div>

  <form method="get" class="row g-3 mb-4">
    <div class="col-md-6">
      <label for="sala" class="form-label">Sala</label>
      <select id="sala" name="sala" class="form-select" onchange="this.form.submit()">
        <option value="">Selecione a Sala (com ocorr√™ncias)</option>
        {% for s in salas %}
          <option value="{{ s }}" {% if sala_sel == s %}selected{% endif %}>{{ s }}</option>
        {% endfor %}
      </select>
    </div>

    <div class="col-md-6">
      <label for="aluno" class="form-label">Aluno</label>
      <select id="aluno" name="aluno" class="form-select" onchange="this.form.submit()">
        <option value="">Selecione o Aluno (com ocorr√™ncias)</option>
        {% for a in alunos %}
          <option value="{{ a }}" {% if aluno_sel == a %}selected{% endif %}>{{ a }}</option>
        {% endfor %}
      </select>
    </div>
  </form>

  {% if aluno_sel and sala_sel %}
    {% if ocorrencias %}
      <div class="alert alert-info text-center">
        Ocorr√™ncias encontradas para **{{ aluno_sel }}** ({{ sala_sel }}). Marque as ocorr√™ncias para gerar o PDF.
      </div>
      
      <form method="post" action="{{ url_for('gerar_pdf_aluno') }}">
        <input type="hidden" name="aluno" value="{{ aluno_sel }}">
        <input type="hidden" name="sala" value="{{ sala_sel }}">
        
        <div class="table-responsive">
            <table class="table table-bordered table-striped">
              <thead class="table-light">
                <tr>
                  <th>Selecionar</th>
                  <th>ID</th>
                  <th>Data</th>
                  <th>Descri√ß√£o</th> <th>Status</th>
                </tr>
              </thead>
              <tbody>
{% for o in ocorrencias %}
    <tr>
      <td>
        <input type="checkbox" name="ocorrencias" value="{{ o['ID'] }}"
               {% if o['Status'] == 'ASSINADA' %} disabled {% endif %}>
      </td>
      <td>{{ o['ID'] }}</td>
      <td>{{ o['DCO'] }}</td> 
      <td style="text-align:left">{{ o['Descri√ß√£o da Ocorr√™ncia'] }}</td>
      <td>
        <span class="badge bg-{% if o.Status == 'ASSINADA' %}success{% elif o.Status == 'ATENDIMENTO' %}warning{% else %}danger{% endif %}">
            {{ o['Status'] }}
        </span>
      </td>
    </tr>
{% endfor %}
</tbody>
            </table>
        </div>
        
        <div class="text-center mt-3">
          <button type="submit" class="btn btn-success">üìÑ Gerar PDF</button>
        </div>
      </form>
    {% else %}
      <div class="alert alert-warning text-center">
        Nenhuma ocorr√™ncia encontrada para este aluno na sala selecionada.
      </div>
    {% endif %}
  {% else %}
    <div class="alert alert-info text-center">
        Selecione a **Sala** e o **Aluno** acima para visualizar as ocorr√™ncias.
    </div>
  {% endif %}
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
