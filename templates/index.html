<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>SGCE - Gest√£o de Ocorr√™ncias</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    body {
      background-color: #121212;
      color: #eaeaea;
      font-size: 11px;
    }
    h2 {
      text-align: center;
      color: #fff;
      font-weight: 600;
      margin-bottom: 15px;
      font-size: 18px;
    }
    .container {
      max-width: 95%;
      margin-top: 15px;
    }
    .table {
      font-size: 11px;
      line-height: 1.1;
      border-collapse: collapse;
      width: 100%;
    }
    .table thead th {
      background-color: #1e1e1e;
      color: #fff;
      padding: 6px;
      white-space: nowrap;
      border-bottom: 2px solid #2a2a2a;
      text-align: center;
    }
    .table tbody td {
      padding: 4px 6px;
      white-space: nowrap;
      text-align: center;
      border-color: #2a2a2a;
    }
    .table-striped tbody tr:nth-of-type(odd) {
      background-color: #1a1a1a;
    }
    .table-striped tbody tr:nth-of-type(even) {
      background-color: #181818;
    }
    .table tbody tr:hover {
      background-color: #242424;
    }
    .badge-ok {
      background-color: #28a745 !important;
      color: #fff !important;
      padding: 3px 5px;
      font-size: 10px;
      border-radius: 4px;
    }
    .badge-pendente {
      background-color: #ffc107 !important;
      color: #212529 !important;
      padding: 3px 5px;
      font-size: 10px;
      border-radius: 4px;
    }
    .btn-sm {
      font-size: 10px;
      padding: 2px 6px;
    }
    .text-end .btn {
      font-size: 11px;
      padding: 4px 10px;
    }
    .form-control, .form-select {
      font-size: 11px;
      padding: 4px 6px;
    }
    .filter-bar {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }
    .filter-bar input, .filter-bar select {
      flex: 1;
      min-width: 150px;
    }
  </style>
</head>

<body>
  <div class="container">
    <h2>Sistema de Gest√£o de Conviv√™ncia Escolar</h2>

    <!-- Barra de filtros -->
    <form method="get" action="{{ url_for('index') }}" class="filter-bar">
      <input type="text" name="busca" class="form-control" placeholder="üîç Buscar aluno, professor ou sala..." value="{{ request.args.get('busca', '') }}">
      <select name="status" class="form-select">
        <option value="">Status</option>
        <option value="ATENDIMENTO" {% if request.args.get('status') == 'ATENDIMENTO' %}selected{% endif %}>ATENDIMENTO</option>
        <option value="FINALIZADA" {% if request.args.get('status') == 'FINALIZADA' %}selected{% endif %}>FINALIZADA</option>
      </select>
      <button type="submit" class="btn btn-primary btn-sm">Filtrar</button>
      <a href="{{ url_for('index') }}" class="btn btn-secondary btn-sm">Limpar</a>
      <a href="{{ url_for('relatorio_inicial') }}" class="btn btn-success btn-sm">üìä Relat√≥rio</a>
      <a href="{{ url_for('nova') }}" class="btn btn-warning btn-sm">‚ûï Nova</a>
    </form>

    <!-- Tabela -->
    <div class="table-responsive">
      <table class="table table-dark table-striped table-bordered text-center align-middle">
        <thead>
          <tr>
            <th>ID</th>
            <th>Data</th>
            <th>Hora</th>
            <th>Aluno</th>
            <th>Sala</th>
            <th>Professor</th>
            <th>Tutor</th>
            <th>FT</th>
            <th>FC</th>
            <th>FG</th>
            <th>Status</th>
            <th>A√ß√µes</th>
          </tr>
        </thead>
        <tbody>
          {% for r in registros %}
          <tr class="{% if r.STATUS == 'FINALIZADA' %}table-success text-dark{% elif r.STATUS == 'ATENDIMENTO' %}table-warning text-dark{% endif %}">
            <td>{{ r.ID }}</td>
            <td>{{ r.DCO }}</td>
            <td>{{ r.HCO }}</td>
            <td>{{ r.ALUNO }}</td>
            <td>{{ r.SALA }}</td>
            <td>{{ r.PROFESSOR }}</td>
            <td>{{ r.TUTOR }}</td>

            <td>{% if r.FT == 'SIM' %}<span class="badge badge-pendente">‚ö†Ô∏è</span>{% else %}<span class="badge badge-ok">‚úîÔ∏è</span>{% endif %}</td>
            <td>{% if r.FC == 'SIM' %}<span class="badge badge-pendente">‚ö†Ô∏è</span>{% else %}<span class="badge badge-ok">‚úîÔ∏è</span>{% endif %}</td>
            <td>{% if r.FG == 'SIM' %}<span class="badge badge-pendente">‚ö†Ô∏è</span>{% else %}<span class="badge badge-ok">‚úîÔ∏è</span>{% endif %}</td>

            <td>
              {% if r.STATUS == 'ATENDIMENTO' %}
                <span class="badge bg-warning text-dark">{{ r.STATUS }}</span>
              {% else %}
                <span class="badge bg-success">{{ r.STATUS }}</span>
              {% endif %}
            </td>

            <td>
              <a href="{{ url_for('editar', oid=r.ID) }}" class="btn btn-info btn-sm">Ver</a>
              <a href="#" class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#senhaModal"
                 onclick="setEditarOid({{ r.ID }})">Editar</a>
            </td>
          </tr>
          {% else %}
          <tr><td colspan="12" class="text-center">Nenhuma ocorr√™ncia encontrada.</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

  <!-- Modal de Senha -->
  <div class="modal fade" id="senhaModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <form method="post" action="{{ url_for('editar', oid=0) }}">
          <div class="modal-header">
            <h5 class="modal-title text-dark">üîí Acesso Restrito</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body text-dark">
            <input type="hidden" name="oid" id="editarOid">
            <div class="mb-3">
              <label for="senha" class="form-label">Digite a senha:</label>
              <input type="password" class="form-control" name="senha" id="senha" required>
            </div>
            <div id="senhaErro" class="text-danger" style="display:none;">Senha incorreta!</div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
            <button type="submit" class="btn btn-primary">Confirmar</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <script>
    function setEditarOid(oid) {
      document.getElementById('editarOid').value = oid;
      const form = document.querySelector('#senhaModal form');
      if (form) {
        form.action = "{{ url_for('editar', oid=0) }}".replace('/0', '/' + oid);
      }
    }
  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
