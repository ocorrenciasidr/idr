<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Gest√£o de Conviv√™ncia - Ocorr√™ncias</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <style>
        body { background: #f4f4f4; }
        .container { margin-top: 40px; }
        table th, table td { vertical-align: middle; text-align: center; }
        h2 { text-align: center; margin-bottom: 30px; }
        .btn { margin: 2px; }
    </style>
</head>
<body>
<div class="container">
    <h2>Sistema de Gest√£o de Conviv√™ncia - IDR</h2>

    <!-- Filtros -->
    <form method="get" class="row mb-4 align-items-end">
        <div class="col-md-4">
            <label for="tutor" class="form-label">Tutor</label>
            <select name="tutor" id="tutor" class="form-select">
                <option value="">Todos</option>
                {% for t in tutores %}
                    <option value="{{ t }}" {% if request.args.get('tutor') == t %}selected{% endif %}>{{ t }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="col-md-4">
            <label for="status" class="form-label">Status</label>
            <select name="status" id="status" class="form-select">
                <option value="">Todos</option>
                <option value="Em Atendimento" {% if request.args.get('status') == 'Em Atendimento' %}selected{% endif %}>Em Atendimento</option>
                <option value="Finalizada" {% if request.args.get('status') == 'Finalizada' %}selected{% endif %}>Finalizada</option>
                <option value="Assinada" {% if request.args.get('status') == 'Assinada' %}selected{% endif %}>Assinada</option>
            </select>
        </div>
        <div class="col-md-4 d-flex justify-content-between">
            <button type="submit" class="btn btn-primary w-50 me-2">Filtrar</button>
            <a href="{{ url_for('nova') }}" class="btn btn-success w-50">Nova Ocorr√™ncia</a>
        </div>
    </form>

    <!-- Tabela -->
    <table class="table table-striped table-bordered">
        <thead class="table-dark">
        <tr>
            <th>N¬∫</th>
            <th>Data</th>
            <th>Hora</th>
            <th>Professor</th>
            <th>Sala</th>
            <th>Aluno</th>
            <th>Tutor</th>
            <th>Status</th>
            <th>A√ß√µes</th>
        </tr>
        </thead>
        <tbody>
        {% for reg in registros %}
            <tr>
                <td>{{ reg["N¬∫ Ocorr√™ncia"] }}</td>
                <td>{{ reg["Data Cria√ß√£o"] }}</td>
                <td>{{ reg["Hora Cria√ß√£o"] }}</td>
                <td>{{ reg["Professor"] }}</td>
                <td>{{ reg["Sala"] }}</td>
                <td>{{ reg["Aluno"] }}</td>
                <td>{{ reg["Tutor"] }}</td>
                <td>{{ reg["Status"] }}</td>
                <td>
                    <button
                        class="btn btn-secondary btn-sm px-2 py-1"
                        title="Visualizar"
                        onclick="window.location.href='{{ url_for('editar', oid=reg['N¬∫ Ocorr√™ncia']) }}'">
                        üîç
                    </button>
                    <button
                        class="btn btn-primary btn-sm px-2 py-1"
                        title="Editar (Gest√£o)"
                        onclick="
                          const pwd = prompt('Digite a senha para editar:');
                          if (pwd === 'Gest@0IDR') {
                            window.location.href='{{ url_for('editar', oid=reg['N¬∫ Ocorr√™ncia'], campo='edit') }}';
                          } else if (pwd !== null) { alert('Senha incorreta!'); }
                        ">
                        ‚úèÔ∏è
                    </button>
                </td>
            </tr>
        {% else %}
            <tr>
                <td colspan="9" class="text-center">Nenhuma ocorr√™ncia encontrada.</td>
            </tr>
        {% endfor %}
        </tbody>
    </table>

    <div class="text-center mt-4">
        <button
            class="btn btn-info"
            onclick="
                const pwd = prompt('Digite a senha para acessar os relat√≥rios:');
                if (pwd === 'Gest@0IDR') {
                    window.location.href='{{ url_for('relatorio') }}';
                } else if (pwd !== null) { alert('Senha incorreta!'); }
            ">
            Relat√≥rios
        </button>
    </div>
</div>
</body>
</html>
