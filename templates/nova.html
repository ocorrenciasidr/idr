<!-- templates/nova.html -->
<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="utf-8"/>
  <title>SGCE — Nova Ocorrência</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    :root{ --bg:#0f1724; --panel:#071428; --muted:#b6c2d1; }
    body{background:var(--bg); color:#fff; font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto; padding:22px;}
    .panel{max-width:920px;margin:auto;background:linear-gradient(180deg,#0b1220,#07101a);padding:24px;border-radius:12px;box-shadow:0 8px 30px rgba(2,6,23,.6);}
    label{font-weight:600;color:#e6eef8}
    .form-control,.form-select,textarea{background:#071428;color:#e6eef8;border:1px solid rgba(255,255,255,0.06)}
    .btn-dark{background:#1f2937;color:#fff;border:1px solid rgba(255,255,255,0.04);border-radius:8px;font-weight:600}
    .btn-outline-light{border-radius:8px;font-weight:600;color:#fff;border-color:rgba(255,255,255,0.08)}
    .small-note{font-size:.86rem;color:var(--muted)}
    .check-label{font-weight:500;margin-left:6px}
  </style>
</head>
<body>
  <div class="panel">
    <h3 class="mb-4 text-center">Registrar Nova Ocorrência</h3>

    <form id="novaForm" method="post" action="{{ url_for('nova') }}">
      <div class="row g-3">

        <div class="col-md-6">
          <label>Professor</label>
          <select name="PROFESSOR" id="prof" class="form-select">
            <option value="">-- selecione --</option>
            {% for p in professores_disp %}
              <option value="{{ p }}">{{ p }}</option>
            {% endfor %}
          </select>
        </div>

        <div class="col-md-6">
          <label>Sala</label>
          <select name="SALA" id="sala" class="form-select" required>
            <option value="">-- selecione --</option>
            {% for s in salas_disp %}
              <option value="{{ s }}">{{ s }}</option>
            {% endfor %}
          </select>
        </div>

        <div class="col-md-6">
          <label>Aluno</label>
          <select name="ALUNO" id="aluno" class="form-select" required>
            <option value="">Selecione a sala primeiro</option>
          </select>
        </div>

        <div class="col-md-6">
          <label>Tutor</label>
          <input type="text" name="TUTOR" id="tutor" class="form-control" readonly />
          <div class="small-note mt-1">Será preenchido ao escolher o aluno.</div>
        </div>

        <div class="col-12">
          <label>Descrição da Ocorrência</label>
          <textarea name="DESCRICAO" rows="4" class="form-control" required></textarea>
        </div>

        <!-- ATP -->
        <div class="col-12">
          <label>Atendimento Professor (ATP)</label>
          <textarea name="ATP" rows="3" class="form-control"></textarea>
        </div>

        <!-- PT/PC/PG checkboxes -->
        <div class="col-md-4">
          <div class="form-check mt-2">
            <input class="form-check-input" type="checkbox" name="PT" id="PT" value="SIM">
            <label class="form-check-label check-label" for="PT">Atendimento Tutor (PT)</label>
          </div>
        </div>

       <div class="col-md-4">
  <div class="form-check mt-2">
    <input class="form-check-input" type="checkbox" name="FT" id="FT" value="SIM">
    <label class="form-check-label check-label" for="FT">Atendimento Tutor (FT)</label>
  </div>
</div>

<div class="col-md-4">
  <div class="form-check mt-2">
    <input class="form-check-input" type="checkbox" name="FT" id="FT" value="SIM">
    <label class="form-check-label check-label" for="FT">Atendimento Tutor (FT)</label>
  </div>
</div>

<div class="col-md-4">
  <div class="form-check mt-2">
    <input class="form-check-input" type="checkbox" name="FC" id="FC" value="SIM">
    <label class="form-check-label check-label" for="FC">Atendimento Coord. (FC)</label>
  </div>
</div>

<div class="col-md-4">
  <div class="form-check mt-2">
    <input class="form-check-input" type="checkbox" name="FT" id="FT" value="SIM">
    <label class="form-check-label check-label" for="FT">Atendimento Tutor (FT)</label>
  </div>
</div>

<div class="col-md-4">
  <div class="form-check mt-2">
    <input class="form-check-input" type="checkbox" name="FC" id="FC" value="SIM">
    <label class="form-check-label check-label" for="FC">Atendimento Coord. (FC)</label>
  </div>
</div>

<div class="col-md-4">
  <div class="form-check mt-2">
    <input class="form-check-input" type="checkbox" name="FG" id="FG" value="SIM">
    <label class="form-check-label check-label" for="FG">Atendimento Gestão (FG)</label>
  </div>
</div>

<input type="hidden" name="FT_present" value="1">
<input type="hidden" name="FC_present" value="1">
<input type="hidden" name="FG_present" value="1">

<div class="col-12 d-flex gap-2 justify-content-end mt-4">
  <a href="{{ url_for('index') }}" class="btn btn-outline-light">Cancelar</a>
  <button id="submitBtn" type="submit" class="btn btn-dark">Registrar Ocorrência</button>
</div>

<script>
  // ... (código anterior para carregar sala/aluno) ...

  // Antes do submit: garantir campos FT/FC/FG explícitos (se desmarcado -> envia "NÃO")
  document.getElementById('novaForm').addEventListener('submit', function(e) {
    const submitBtn = document.getElementById('submitBtn');
    submitBtn.disabled = true;
    submitBtn.textContent = 'Registrando...';

    ['FT','FC','FG'].forEach(name => {
      const el = document.getElementById(name);
      if (!el) return;
      if (!el.checked) {
        if (!document.querySelector(`input[type="hidden"][name="${name}"]`)) {
          const h = document.createElement('input');
          h.type = 'hidden';
          h.name = name;
          h.value = 'NÃO';
          this.appendChild(h);
        }
      }
    });
  });
</script>
</body>
</html>



